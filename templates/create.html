{% extends 'index.html' %}
{% load static %}
{% block head %}
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <link href="{% static 'lib/select2-4.0.13/css/select2-bootstrap4.min.css' %}" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="{% static 'lib/select2-4.0.13/js/i18n/es.js' %}"></script>
{% endblock %}

{% block content %}
    <div class="card card-default" style="margin-left: 10%; margin-right: 10%;">
        <form method="post" action="." enctype="multipart/form-data">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-{{ icontitle }}"></i>
                    {{ title }}
                </h3>
            </div>

            <!-- /.card-header -->
            <div class="card-body">
                {% csrf_token %}
                <input type="hidden" name="action" value="{{ action }}"/>
                {% for field in form.visible_fields %}
                    <div class="form-group">
                        {{ field.label_tag }}
                        {{ field }}
                    </div>
                {% endfor %}
            </div>
            <div class="card-footer">
                <button type="submit" class="btn btn-primary btn-flat">
                    <i class="fas fa-save"></i>
                    Guardar registro
                </button>
            </div>
            <!-- /.card-body -->
        </form>
        <script>
            $(function () {
                $('.select2').select2({
                    'theme': 'bootstrap4',
                    'language': 'es'
                });
            });
            {% if form.errors %}
                var errors = '';
                {% for field in form %}
                    {% for error in field.errors %}
                        errors += '{{ error }}\n'
                    {% endfor %}
                {% endfor %}
                Swal.fire({
                    icon: 'error',
                    title: '¡Error!',
                    text: errors,
                })
            {% endif %}
            $('form').on('submit', function (event) {
                event.preventDefault();
                const form = this;
                const parameters = new FormData(form);
                disableEnableForm(form, true);
                submit_with_ajax(
                    window.location.pathname, parameters
                    , 'Confirmación'
                    , '¿Estas seguro de realizar la siguiente acción?'
                    , function (data) {
                        location.href = '{{ url_list }}';
                    }
                );
            });
        </script>
    </div>
{% endblock %}